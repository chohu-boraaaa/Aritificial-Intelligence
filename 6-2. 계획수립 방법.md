# 계획수립방법

## 1. 고전적 계획수립 방법

### 상태공간 계획수립
- 상태공간 : 문제의 세상에서 나타나는 상태들의 집합
- 초기상태를 목표 상태로 변환시키는 일련의 연산자(행동) 찾기
- 전향탐색
- 후향탐색
- STRIPS 알고리즘
- GraphPlan 알고리즘

### 계획공간 계획수립
- 계획공간 : 모든 가능한 (부분) 계획들의 집합
- 노드 : 부분계획(작업들의 집합 + 작업 실행순서 등의 제약조건, 계획요소로 구성됨)
- 에지 : 부분계획을 변환하는 연산자

### 계층적 계획수립
- 특정 영역의 문제해결을 위한 작업 방법에 대한 지식을 여러 추상화 수준의 계층적인 구조로 기술
- 추상적인 계획에서 시작하여 점점 구체적인 계획으로 구성
- HTN (hierarchical task network) 알고리즘

## 2. 상태공간 계획수립(state-space planning)

### 상태공간 상의 초기 상태에서 목표 상태로의 경로 탐색
- 노드(node) : 세계(world)의 상태
- 에지(edge) : 상태 전이(transition)을 일으키는 행동(action)

### 행동 = 바로 적용할 수 있는 기본 행동
- 연산자(operator) = 기본 행동

### 2-1. 전향 탐색과 후향 탐색

#### 전향탐색
- 초기 상태에서 시작
- 적용가능한 연산자를 목표 상태에 도달할 때까지 적용
- 다양한 알고리즘 적용 가능 : 너비우선 탐색, 깊이우선 탐색, 휴리스틱 탐색 중 A* 알고리즘

#### 후향탐색
- 목표 상태에서 시작
- 해당 상태를 만들어내는 행동 선택을 시작 상태에 도달할 때까지 반복

### 2-2. STRIPS 계획수립 알고리즘
- 기본적으로 후향탐색
- 목표상태가 만족되지 않으면 목표상태를 effect로 만들 수 있는 연산자(행동) 선택하여 연산자의 매개변수를 설정하고 precondition(전제조건)이 만족되는지 확인
- precondition 중에 만족되지 않는 것이 있다면 그것을 effect로 하여 위 과정 반복
- 모든 precondition이 만족되면 사용된 매개변수 설정된 연산자들을 역순으로 나열하여 계획생성

#### STRIPS 알고리즘 적용 예 
![image](https://user-images.githubusercontent.com/77424107/145420215-a95f2236-e1ba-4996-8e56-8dfd77254796.png)
![image](https://user-images.githubusercontent.com/77424107/145420365-a4011959-fc8f-410a-9da4-6f5f18b5ff90.png)
![image](https://user-images.githubusercontent.com/77424107/145420665-f04699c9-1a21-4235-bcf7-ac0090843705.png)
![image](https://user-images.githubusercontent.com/77424107/145420804-ae40a3c2-a8d1-4a66-8ba4-553128993a33.png)

### 2-3. GraphPlan 알고리즘

#### 계획수립 그래프 방법(planning graph method)
- 계획수립 그래프를 사용하여 탐색공간 표현
- 탐색 알고리즘에서 분기계수 축소
- 후향탐색시 초기 상태에 도달할 수 있는 없는(?) 행동의 시도 축소

#### GraphPlan 알고리즘
- 기존 계획공간 계획수립에 비해 매우 빠른 속도
- 이후 GraphPlan 기반의 많은 계획수립 알고리즘 개발
- 변수가 없는 연산자들로 구성된 STRIPS 문제 해결

##### 변수 포함 연산자 변환
- 변수에 가능한 모든 객체 바인딩
- 가능한 바인딩 조합의 개수만큼 변수가 없는 연산자 생성
- 예. 연산자 On(x,y)에 대한 2개의 객체 : 4개의 연산자 생성 : On(a,a), On(a,b), On(b,a), On(b,b)
- 단점 : 연산자의 개수가 많이 늘어남
- 장점 : 변수를 사용하지 않아 매칭 연산 용이

##### 계획수립 그래프
- 명제 단계와 행동 단계가 번갈아가면서 구성
![image](https://user-images.githubusercontent.com/77424107/145422851-40d09dc6-98f9-4404-99f3-e0239feb5158.png)
- 명제 단계 0 : 초기 상태에 주어지는 각 리터럴을 노드로 표현
- 행동 단계 1 : 명제 단계 0의 문제들에 대해 적용될 수 있는 각 행동을 노드로 표현, 명제 단계 0에 나타나는 precondition의 리터럴 노드와 연결, 명제 단계 2에 나타나는 Effect의 리터럴 노드와 연결
- 명제 단계 2 : 행동 단계 1의 행동의 Effects 부분에 나타나는 리터럴들과 명제 단계 0의 리터럴들에 대응하는 노드 생성, 명제 단계 0의 모든 노드를 명제 단계 2에 유지
- 행동 단계 3과 명제 단계 4를 동일한 방법으로 반복
- 행동 단계와 명제 단계 확장

###### 계획수립 그래프의 확장
- 상호배제 링크 : 행동 단계와 명제 단계 한 쌍의 추가 시, 동시에 실행되거나 만족될 수 없는 동일 단계의 노드들 사이 연결
- 행동 단계의 상호배제
- -> 상충되는 결과 도출 : 한 행동의 effect가 다른 행동의 effect가 만드는 명제를 제거하는 경우
- -> 간섭 : 한 행동이 다른 행동의 effect가 만드는 명제를 제거하는 경우
- -> 경쟁관계 사전조건 : 두 행동이 직전 단계에서 상호배제관계에 있는 명제들을 precondition에서 사용하는 경우
- 명제 단계의 상호배제 : 상충되는 지지 - 대응되는 두 명제를 만들어내는 이전 단계의 모든 행동이 서로 상호배제 관계에 있는 경우

##### GraphPlan 알고리즘 및 사례

###### 알고리즘
1. 초기 상태의 리터럴들에 해당하는 노드들을 단계 0에 만든다.
2. k <- 0
3. 현재 명제 단계에 적용될 수 있는 행동들에 대한 노드를 행동 단계 k+1에 만들고, 이들 행동의 effect에 있는 리터럴에 해당하는 노드들을 명제 단계 k+2에 만든다
4. k <- k+2
5. 현재 명제 단계 k에서 목표 상태에 있는 모든 리터럴들이 상호배타적이지 않은 상태로 있으며 단계 k의 해당 리터럴을 부분목표로 하는 계획을 찾는다. 그렇지 않으면 단계 3으로 간다.
5.1. 단계 k의 각 부분목표에 대해서, 단계 k-1에서 해당 부분목표를 달성할 수 있는 행동을 선택한다.
5.2. 선택된 행동이 이미 선택된 단계 k-1의 다른 행동과 상호배타관계에 있으면, 해당 부분목표는 실패한 것으로 간주하고, 단계 3으로 간다.
5.3. 선택된 행동의 precondition에 있는 리터럴들이 상호배타관계에 있지 않으면, 해당 리터럴들을 부분목표로 하고, k <- k-2로 하여 단계 5.1로 돌아가서 반복한다.
5.4. k=0이면, 선택된 행동들은 단계 1부터 순서대로 나열한 것이 계획이 된다.

###### 생일저녁 준비 문제
- 생일 날 집에서 자고 있는 누군가를 위해 생일 저녁을 준비하는 일을 계획
- 목적 : 생일 저녁을 위해 주방을 치우고, 선물과 저녁식사 준비
- 명제기호 : grab(쓰레기가 주방에 있다), dinner(저녁식사가 준비되어 있다), present(선물이 준비되어 있다), clean(손이 깨끗하다), quiet(조용하다)
- 초기상태 : grab ^ clean ^ quiet
- 목표상태 : ㄱgrab ^ dinner ^ present
- 행동 : cook(요리하기), wrap(선물포장), carry(손으로 치우기), dolly(손수레로 치우기)
![image](https://user-images.githubusercontent.com/77424107/145443600-ad43e274-dec9-4d70-9fbe-b43345902a06.png)
![image](https://user-images.githubusercontent.com/77424107/145443727-f2382dec-d06e-40e0-9c4e-1b2816e73734.png)
![image](https://user-images.githubusercontent.com/77424107/145451037-715df045-7118-45d0-976e-5c948db44e4c.png)
![image](https://user-images.githubusercontent.com/77424107/145451298-8a87684b-3e59-4604-b89e-fcfcda4fd0e8.png)

